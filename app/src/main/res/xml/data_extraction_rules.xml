<?xml version="1.0" encoding="utf-8"?>
<!--
// =================================================================================
// FILE: ./app/src/main/res/xml/data_extraction_rules.xml
// REASON: FIX (Daily Restore) - Added an <exclude> rule for the new
// 'finlight_internal_state.xml' SharedPreferences file. This file contains a
// flag to track if the app has been launched before. Excluding it from backups
// is CRITICAL, as it ensures the "first launch" state can be reliably detected
// after a reinstall, preventing the app from restoring data every day.
// =================================================================================
-->
<data-extraction-rules>
    <cloud-backup>
        <!-- Include standard preferences -->
        <include domain="sharedpref" path="."/>
        <!-- Exclude the file with the now-unusable encrypted key -->
        <exclude domain="sharedpref" path="finlight_secure_prefs.xml" />
        <!-- NEW: Exclude the internal state file that tracks first launch -->
        <exclude domain="sharedpref" path="finlight_internal_state.xml"/>

        <!-- DO NOT include the 'database' domain for cloud backup. -->
        <!-- The restored .db file would be encrypted and unusable without the Keystore key. -->

        <!-- THIS IS THE FIX: Include the 'file' domain, which contains backup_snapshot.gz -->
        <include domain="file" path="." />
        <!-- But, exclude the large, non-essential image attachments from the backup -->
        <exclude domain="file" path="attachments/" />
    </cloud-backup>

    <device-transfer>
        <!-- For device-to-device transfers, we can include everything -->
        <include domain="sharedpref" path="."/>
        <exclude domain="sharedpref" path="finlight_secure_prefs.xml" />
        <!-- NEW: Exclude the internal state file here as well for consistency -->
        <exclude domain="sharedpref" path="finlight_internal_state.xml"/>
        <include domain="database" path="." />
        <include domain="file" path="." />
        <exclude domain="file" path="attachments/" />
    </device-transfer>
</data-extraction-rules>